<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>99乘法考試</title>

<style>
body{
 margin:0;
 font-family:"Arial Rounded MT Bold",system-ui;
 background:linear-gradient(135deg,#fff0f6,#e0f7ff);
 text-align:center;
}
.container{
 max-width:420px;
 margin:auto;
 padding:20px;
}
h1{color:#ff6fae;}
.question{
 font-size:36px;
 margin:20px 0;
}
.timer{
 font-size:28px;
 color:#ff5252;
}
.progress{
 margin:10px;
 font-size:18px;
}
.keypad{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:12px;
 margin-top:20px;
}
button{
 font-size:24px;
 padding:18px;
 border:none;
 border-radius:14px;
 background:#fff;
 box-shadow:0 4px 8px rgba(0,0,0,.15);
}
button:active{transform:scale(.95);}
.start-btn{
 background:#ff8fc7;
 color:#fff;
 font-size:26px;
}
.hidden{display:none;}

.modal{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.4);
 display:flex;
 align-items:center;
 justify-content:center;
}
.card{
 background:#fff;
 border-radius:20px;
 padding:20px;
 width:90%;
 max-width:400px;
 animation:pop .4s ease;
}
@keyframes pop{
 from{transform:scale(.7);opacity:0}
 to{transform:scale(1);opacity:1}
}
.score{
 font-size:28px;
 color:#ff6fae;
}
.avg{
 font-size:20px;
 margin:10px 0;
}
.detail{
 text-align:left;
 margin-top:15px;
 max-height:200px;
 overflow:auto;
}
.detail div{
 padding:6px;
}
.wrong{
 color:red;
 font-weight:bold;
}
.small-btn{
 margin-top:12px;
 font-size:18px;
 padding:10px;
 background:#e0f7ff;
}
</style>
</head>

<body>
<div class="container">
 <h1>99乘法考試</h1>

 <div id="start">
  <button class="start-btn" onclick="startExam()">開始測驗</button>
 </div>

 <div id="exam" class="hidden">
  <div class="progress" id="progress"></div>
  <div class="timer" id="timer">8</div>
  <div class="question" id="question"></div>
  <div class="keypad" id="keypad"></div>
 </div>
</div>

<!-- 成績彈窗 -->
<div id="modal" class="modal hidden">
 <div class="card">
  <div class="score" id="scoreText"></div>
  <div class="avg" id="avgText"></div>

  <button class="small-btn" onclick="toggleDetail()">查看錯誤明細</button>

  <div class="detail hidden" id="detailList"></div>

  <button class="small-btn" onclick="restart()">重新測驗</button>
 </div>
</div>

<script>
let total=30, idx=0, a=0,b=0;
let timer=8, tId;
let correct=0;
let answer="";
let startTime;
let correctTimes=[];
let wrongDetails=[];

function startExam(){
 document.getElementById("start").classList.add("hidden");
 document.getElementById("exam").classList.remove("hidden");
 idx=0; correct=0; correctTimes=[]; wrongDetails=[];
 nextQ();
}

function nextQ(){
 if(idx>=total){ finish(); return; }
 idx++;
 a=Math.floor(Math.random()*9)+1;
 b=Math.floor(Math.random()*9)+1;
 answer="";
 timer=8;
 startTime=Date.now();
 updateUI();
 startTimer();
}

function updateUI(){
 document.getElementById("progress").textContent=`第 ${idx} / ${total} 題`;
 document.getElementById("question").textContent=`${a} × ${b} = ?`;
 document.getElementById("timer").textContent=timer;
 drawKeys();
}

function startTimer(){
 clearInterval(tId);
 tId=setInterval(()=>{
  timer--;
  document.getElementById("timer").textContent=timer;
  if(timer<=0){
   wrongDetails.push(`${a}×${b} = ${a*b}`);
   clearInterval(tId);
   setTimeout(nextQ,500);
  }
 },1000);
}

function drawKeys(){
 const k=document.getElementById("keypad");
 k.innerHTML="";
 for(let i=0;i<=9;i++){
  const btn=document.createElement("button");
  btn.textContent=i;
  btn.onclick=()=>press(i);
  k.appendChild(btn);
 }
 const del=document.createElement("button");
 del.textContent="⌫";
 del.onclick=()=>{answer=answer.slice(0,-1);}
 k.appendChild(del);
 const ok=document.createElement("button");
 ok.textContent="OK";
 ok.onclick=check;
 k.appendChild(ok);
}

function press(n){ answer+=n; }

function check(){
 if(answer==="")return;
 clearInterval(tId);
 if(Number(answer)===a*b){
  correct++;
  correctTimes.push((Date.now()-startTime)/1000);
 }else{
  wrongDetails.push(`${a}×${b} = ${a*b}`);
 }
 setTimeout(nextQ,300);
}

function finish(){
 document.getElementById("exam").classList.add("hidden");
 document.getElementById("modal").classList.remove("hidden");

 const avg = correctTimes.length
 ? (correctTimes.reduce((a,b)=>a+b,0)/correctTimes.length).toFixed(1)
 : 0;

 document.getElementById("scoreText").textContent=`成績：${correct} / ${total}`;
 document.getElementById("avgText").textContent=`平均作答時間：${avg} 秒`;

 const d=document.getElementById("detailList");
 d.innerHTML=wrongDetails.map(x=>`<div class="wrong">${x}</div>`).join("");
}

function toggleDetail(){
 document.getElementById("detailList").classList.toggle("hidden");
}

function restart(){ location.reload(); }
</script>
</body>
</html>
