<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>99ä¹˜æ³•è€ƒè©¦</title>

<style>
body{
 margin:0;
 font-family:"Arial Rounded MT Bold","Arial";
 background:linear-gradient(#e3f2fd,#fff);
 text-align:center;
 user-select:none;
}
.container{max-width:420px;margin:auto;padding:20px;}
h1{color:#1976d2;}
#status{font-size:20px;}
#timer{font-size:32px;color:#e53935;font-weight:bold;}
#timer.urgent{
 animation:flash 0.5s infinite;
}
@keyframes flash{
 0%{transform:scale(1);}
 50%{transform:scale(1.3);}
 100%{transform:scale(1);}
}
#question{
 font-size:36px;
 background:#fff9c4;
 padding:15px;
 border-radius:20px;
 margin:15px 0;
}
#reveal{
 display:none;
 font-size:32px;
 color:red;
 font-weight:bold;
 margin:10px 0;
}
#input{
 width:100%;
 height:55px;
 font-size:30px;
 text-align:center;
 border-radius:15px;
 border:3px solid #90caf9;
 background:#e3f2fd;
}
.keypad{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:12px;
 margin-top:15px;
}
.keypad button{
 font-size:26px;
 padding:20px;
 border-radius:20px;
 border:none;
 background:#64b5f6;
 color:white;
}
#startBtn{
 margin-top:18px;
 padding:14px 30px;
 font-size:22px;
 border-radius:20px;
 border:none;
 background:#f48fb1;
 color:white;
}

/* ===== æˆç¸¾ç•«é¢ ===== */
#overlay{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,0.45);
}
#result{
 background:white;
 width:85%;
 max-width:360px;
 margin:90px auto;
 padding:25px;
 border-radius:25px;
 animation:pop 0.4s ease;
}
@keyframes pop{
 from{transform:scale(0.7);opacity:0;}
 to{transform:scale(1);opacity:1;}
}
#result h2{
 margin-top:0;
 font-size:30px;
 color:#1976d2;
}
.score{
 font-size:48px;
 color:#4caf50;
 margin:15px 0;
}
.card{
 background:#f1f8ff;
 border-radius:20px;
 padding:12px;
 margin:10px 0;
 font-size:20px;
}
#restart{
 margin-top:15px;
 padding:14px 30px;
 font-size:22px;
 border:none;
 border-radius:25px;
 background:#ffb74d;
 color:white;
}
</style>
</head>

<body>
<div class="container">
<h1>99ä¹˜æ³•è€ƒè©¦</h1>
<div id="status">å°šæœªé–‹å§‹</div>
<div id="timer">8</div>
<div id="question">è«‹æŒ‰é–‹å§‹</div>
<div id="reveal"></div>
<input id="input" readonly>

<div class="keypad">
<button>1</button><button>2</button><button>3</button>
<button>4</button><button>5</button><button>6</button>
<button>7</button><button>8</button><button>9</button>
<button>0</button><button>æ¸…é™¤</button>
</div>

<button id="startBtn">é–‹å§‹æ¸¬é©—</button>
</div>

<!-- æˆç¸¾ -->
<div id="overlay">
 <div id="result">
  <h2>ğŸ‰ å®Œæˆæ¸¬é©—</h2>
  <div class="score" id="scoreText"></div>
  <div class="card" id="timeText"></div>
  <button id="restart">é‡æ–°æ¸¬é©—</button>
 </div>
</div>

<script>
/* ===== éŸ³è¨Šï¼ˆæœ€ç©©ï¼‰ ===== */
let audioCtx=null;
function ensureAudio(){
 if(!audioCtx){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
 }
 if(audioCtx.state!=="running"){
  audioCtx.resume().catch(()=>{});
 }
}
function unlockOnce(){
 ensureAudio();
 const o=audioCtx.createOscillator();
 const g=audioCtx.createGain();
 g.gain.value=0;
 o.connect(g).connect(audioCtx.destination);
 o.start();
 o.stop(audioCtx.currentTime+0.02);
}
function tickSound(){
 ensureAudio();
 const o=audioCtx.createOscillator();
 const g=audioCtx.createGain();
 o.frequency.value=700;
 g.gain.value=0.06;
 o.connect(g).connect(audioCtx.destination);
 o.start();
 o.stop(audioCtx.currentTime+0.05);
}
function ding(){
 ensureAudio();
 const t=audioCtx.currentTime;
 for(let i=0;i<2;i++){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=800+i*300;
  g.gain.value=0.15;
  o.connect(g).connect(audioCtx.destination);
  o.start(t+i*0.15);
  o.stop(t+i*0.15+0.12);
 }
}
function speak(t){
 speechSynthesis.cancel();
 setTimeout(()=>{
  const u=new SpeechSynthesisUtterance(t);
  u.lang="zh-TW";
  speechSynthesis.speak(u);
 },100);
}

/* ===== éŠæˆ² ===== */
const TOTAL=30,LIMIT=8;
let q=0,a=0,b=0,ans=0,time=0,timer;
let playing=false;
let correct=0;
let times=[];
let qStart=0;

const timerEl=document.getElementById("timer");
const reveal=document.getElementById("reveal");

document.getElementById("startBtn").onclick=()=>{
 if(playing) return;
 unlockOnce();
 start();
};

document.getElementById("restart").onclick=()=>{
 document.getElementById("overlay").style.display="none";
 start();
};

function start(){
 playing=true;
 q=0; correct=0; times=[];
 next();
}

function next(){
 clearInterval(timer);
 reveal.style.display="none";

 if(q>=TOTAL){
  end();
  return;
 }

 q++;
 time=LIMIT;
 timerEl.textContent=time;
 timerEl.classList.remove("urgent");
 document.getElementById("status").textContent=`ç¬¬ ${q} é¡Œ`;
 document.getElementById("input").value="";

 a=Math.floor(Math.random()*9)+1;
 b=Math.floor(Math.random()*9)+1;
 ans=a*b;
 document.getElementById("question").textContent=`${a} Ã— ${b} = ?`;
 qStart=Date.now();

 timer=setInterval(()=>{
  ensureAudio();
  time--;
  timerEl.textContent=time;
  tickSound();
  if(time<=3) timerEl.classList.add("urgent");
  if(time<=0){clearInterval(timer);wrong();}
 },1000);
}

document.querySelectorAll(".keypad button").forEach(btn=>{
 btn.onclick=()=>{
  if(!playing) return;
  ensureAudio();
  if(btn.textContent==="æ¸…é™¤"){
   document.getElementById("input").value="";
   return;
  }
  press(btn.textContent);
 };
});

function press(n){
 const input=document.getElementById("input");
 input.value+=n;
 if(+input.value===ans){
  clearInterval(timer);
  ding();
  correct++;
  times.push((Date.now()-qStart)/1000);
  next();
 }else if(input.value.length>=ans.toString().length){
  clearInterval(timer);
  wrong();
 }
}

function wrong(){
 speak("ç­”éŒ¯äº†");
 reveal.textContent=`æ­£ç¢ºç­”æ¡ˆï¼š${a} Ã— ${b} = ${ans}`;
 reveal.style.display="block";
 setTimeout(next,3200);
}

function end(){
 playing=false;
 speak("æ­å–œä½ å®Œæˆæ¸¬é©—");
 const avg=times.length?(times.reduce((a,b)=>a+b,0)/times.length).toFixed(1):0;
 document.getElementById("scoreText").textContent=`${correct} / ${TOTAL} é¡Œ`;
 document.getElementById("timeText").textContent=`å¹³å‡ç­”å°æ™‚é–“ï¼š${avg} ç§’`;
 document.getElementById("overlay").style.display="block";
}
</script>
</body>
</html>
