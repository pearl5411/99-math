<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>99ä¹˜æ³•è€ƒè©¦</title>

<style>
body{
 margin:0;
 font-family:"Noto Sans TC",system-ui;
 background:#fff3e0;
 text-align:center;
}

h1{color:#ff7043}

.card{
 background:white;
 margin:16px;
 padding:16px;
 border-radius:22px;
 box-shadow:0 4px 12px rgba(0,0,0,.15);
}

#question{
 font-size:34px;
 margin:10px 0;
}

#timer{
 font-size:22px;
 color:#d84315;
}

#answerBox{
 border:4px solid #ffccbc;
 border-radius:14px;
 font-size:32px;
 padding:10px;
 width:160px;
 margin:12px auto;
 background:#fff;
 min-height:40px;
}

.keypad{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 max-width:260px;
 margin:10px auto;
}

.keypad button{
 font-size:26px;
 padding:14px;
 border:none;
 border-radius:16px;
 background:#ffab91;
}

.keypad button:active{
 transform:scale(.95);
}

.controlBtn{
 font-size:22px;
 padding:12px 26px;
 border:none;
 border-radius:18px;
 background:#ff7043;
 color:white;
}

.overlay{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.4);
 display:none;
 justify-content:center;
 align-items:center;
}

.resultCard{
 background:linear-gradient(180deg,#fffdf7,#fff4e6);
 border-radius:26px;
 padding:20px;
 width:90%;
 max-width:360px;
 position:relative;
}

.resultCard::before{
 content:"â­";
 position:absolute;
 top:-14px;
 left:-10px;
 font-size:36px;
}
.resultCard::after{
 content:"ğŸ€";
 position:absolute;
 top:-16px;
 right:-8px;
 font-size:34px;
}

.resultHeader{
 font-size:32px;
 color:#ff6f61;
 font-weight:bold;
}

.scoreRow{
 display:flex;
 justify-content:space-between;
 background:#fff;
 border-radius:14px;
 padding:8px 14px;
 margin:8px 0;
 font-size:20px;
}

.scoreRow span:last-child{
 font-size:24px;
 color:#fa541c;
}

.avgTime{
 font-size:18px;
 color:#9254de;
 margin:10px 0;
}

.resultBtn{
 width:100%;
 margin-top:10px;
 font-size:20px;
 padding:10px;
 border:none;
 border-radius:16px;
}

.retry{background:#52c41a;color:white}
.restart{background:#1890ff;color:white}

.wrongList{
 background:#fff1f0;
 border-radius:16px;
 padding:10px;
 margin-top:10px;
 max-height:160px;
 overflow:auto;
 text-align:left;
}

.wrongItem{
 color:#a8071a;
 margin-bottom:4px;
}
</style>
</head>

<body>

<h1>99ä¹˜æ³•è€ƒè©¦</h1>

<div class="card" id="startCard">
 <button class="controlBtn" id="startBtn">â–¶ é–‹å§‹æ¸¬é©—</button>
</div>

<div class="card" id="quizCard" style="display:none">
 <div id="progress"></div>
 <div id="question"></div>
 <div id="timer"></div>
 <div id="answerBox"></div>

 <div class="keypad">
  <button onclick="press('1')">1</button>
  <button onclick="press('2')">2</button>
  <button onclick="press('3')">3</button>
  <button onclick="press('4')">4</button>
  <button onclick="press('5')">5</button>
  <button onclick="press('6')">6</button>
  <button onclick="press('7')">7</button>
  <button onclick="press('8')">8</button>
  <button onclick="press('9')">9</button>
  <button onclick="del()">âŒ«</button>
  <button onclick="press('0')">0</button>
  <button disabled>ã€€</button>
 </div>
</div>

<div class="overlay" id="resultOverlay">
 <div class="resultCard" id="resultCard"></div>
</div>

<script>
let q=[],idx=0,ans="",timer,sec;
let correct=0,wrong=0;
let correctTimes=[];
let wrongDetail=[];
let audioOK,audioWrong,audioEnd,tick;

function unlockAudio(){
 audioOK=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
 audioWrong=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
 audioEnd=new Audio("https://actions.google.com/sounds/v1/cartoon/ta_da.ogg");
 tick=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
}

document.getElementById("startBtn").onclick=()=>{
 unlockAudio();
 start();
};

function start(list){
 q=list||Array.from({length:30},()=> {
  let a=1+Math.floor(Math.random()*9);
  let b=1+Math.floor(Math.random()*9);
  return {a,b};
 });
 idx=0;correct=0;wrong=0;
 wrongDetail=[];correctTimes=[];
 document.getElementById("startCard").style.display="none";
 document.getElementById("quizCard").style.display="block";
 next();
}

function next(){
 if(idx>=q.length){finish();return;}
 ans="";
 answerBox.innerText="";
 let {a,b}=q[idx];
 question.innerText=`${a} Ã— ${b} = ?`;
 progress.innerText=`ç¬¬ ${idx+1} / ${q.length} é¡Œ`;
 sec=8;
 timerText();
 clearInterval(timer);
 timer=setInterval(()=>{
  sec--;
  tick.currentTime=0;tick.play();
  timerText();
  if(sec<=0){
   clearInterval(timer);
   mark(false);
  }
 },1000);
}

function timerText(){
 timer.innerText=`â± ${sec}`;
}

function press(n){
 if(ans.length>=2) return;
 ans+=n;
 answerBox.innerText=ans;

 let {a,b}=q[idx];
 let correctAns=a*b;

 if(correctAns<10 && ans.length===1){
  mark(Number(ans)===correctAns);
 }
 if(correctAns>=10 && ans.length===2){
  mark(Number(ans)===correctAns);
 }
}

function del(){
 ans=ans.slice(0,-1);
 answerBox.innerText=ans;
}

function mark(ok){
 clearInterval(timer);
 let {a,b}=q[idx];
 if(ok){
  correct++;
  correctTimes.push(8-sec);
  audioOK.currentTime=0;audioOK.play();
 }else{
  wrong++;
  wrongDetail.push(`${a} Ã— ${b} = ${a*b}`);
  audioWrong.currentTime=0;audioWrong.play();
 }
 idx++;
 setTimeout(next,700);
}

function finish(){
 audioEnd.play();
 let avg=correctTimes.length
  ?(correctTimes.reduce((a,b)=>a+b)/correctTimes.length).toFixed(1)
  :0;

 quizCard.style.display="none";
 resultOverlay.style.display="flex";

 resultCard.innerHTML=`
  <div class="resultHeader">ğŸ“˜ æˆç¸¾å–®</div>

  <div class="scoreRow">
   <span>âœ” ç­”å°</span><span>${correct}</span>
  </div>
  <div class="scoreRow">
   <span>âœ– ç­”éŒ¯</span><span>${wrong}</span>
  </div>

  <div class="avgTime">â± å¹³å‡ä½œç­”æ™‚é–“ ${avg} ç§’</div>

  <button class="resultBtn retry" onclick="retryWrong()">ğŸ” éŒ¯é¡Œé‡ç·´</button>
  <button class="resultBtn restart" onclick="location.reload()">ğŸ“ é‡æ–°æ¸¬é©—</button>

  <div class="wrongList">
   ${wrongDetail.map(w=>`<div class="wrongItem">âŒ ${w}</div>`).join("")||"ğŸ‰ å…¨å°ï¼"}
  </div>
 `;
}

function retryWrong(){
 let list=wrongDetail.map(w=>{
  let p=w.match(/(\d+) Ã— (\d+)/);
  return {a:Number(p[1]),b:Number(p[2])};
 });
 resultOverlay.style.display="none";
 quizCard.style.display="block";
 start(list);
}
</script>

</body>
</html>
