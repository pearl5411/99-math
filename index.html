<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>99ä¹˜æ³•è€ƒè©¦</title>

<style>
body{
 margin:0;
 font-family:"Noto Sans TC",system-ui;
 background:#fff3e0;
 text-align:center;
}

h1{color:#ff7043}

.card{
 background:white;
 margin:16px;
 padding:16px;
 border-radius:20px;
 box-shadow:0 4px 10px rgba(0,0,0,.15);
}

#question{
 font-size:32px;
 margin:10px 0;
}

#timer{
 font-size:22px;
 color:#d84315;
}

#answerBox{
 border:3px solid #ffccbc;
 border-radius:12px;
 font-size:28px;
 padding:10px;
 width:140px;
 margin:10px auto;
 background:#fff;
}

.keypad{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 max-width:260px;
 margin:10px auto;
}

.keypad button{
 font-size:26px;
 padding:14px;
 border:none;
 border-radius:14px;
 background:#ffab91;
}

.keypad button:active{
 transform:scale(.95);
}

.controlBtn{
 margin-top:10px;
 font-size:20px;
 padding:10px 20px;
 border:none;
 border-radius:14px;
 background:#ff7043;
 color:white;
}

.overlay{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.4);
 display:none;
 justify-content:center;
 align-items:center;
}

.resultCard{
 background:#fff7e6;
 border-radius:22px;
 padding:20px;
 width:90%;
 max-width:360px;
}

.resultHeader{
 font-size:30px;
 color:#ff6f61;
 font-weight:bold;
}

.scoreRow{
 display:flex;
 justify-content:space-between;
 font-size:20px;
 margin:6px 0;
}

.wrongList{
 background:#fff1f0;
 border-radius:14px;
 padding:10px;
 margin-top:10px;
 text-align:left;
 max-height:160px;
 overflow:auto;
}

.wrongItem{color:#a8071a}

.resultBtn{
 width:100%;
 margin-top:10px;
 font-size:20px;
 padding:10px;
 border:none;
 border-radius:14px;
}

.retry{background:#52c41a;color:white}
.restart{background:#1890ff;color:white}
</style>
</head>

<body>

<h1>99ä¹˜æ³•è€ƒè©¦</h1>

<div class="card" id="startCard">
 <button class="controlBtn" id="startBtn">â–¶ é–‹å§‹æ¸¬é©—</button>
</div>

<div class="card" id="quizCard" style="display:none">
 <div id="progress"></div>
 <div id="question"></div>
 <div id="timer"></div>
 <div id="answerBox"></div>

 <div class="keypad">
  <button onclick="press('1')">1</button>
  <button onclick="press('2')">2</button>
  <button onclick="press('3')">3</button>
  <button onclick="press('4')">4</button>
  <button onclick="press('5')">5</button>
  <button onclick="press('6')">6</button>
  <button onclick="press('7')">7</button>
  <button onclick="press('8')">8</button>
  <button onclick="press('9')">9</button>
  <button onclick="del()">âŒ«</button>
  <button onclick="press('0')">0</button>
  <button onclick="submit()">å®Œæˆ</button>
 </div>
</div>

<div class="overlay" id="resultOverlay">
 <div class="resultCard" id="resultCard"></div>
</div>

<script>
let q=[],idx=0,ans="",timer,sec;
let correct=0,wrong=0;
let correctTimes=[];
let wrongDetail=[];
let audioOK,audioWrong,audioEnd,tick;

function unlockAudio(){
 audioOK=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
 audioWrong=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
 audioEnd=new Audio("https://actions.google.com/sounds/v1/cartoon/ta_da.ogg");
 tick=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
}

document.getElementById("startBtn").onclick=()=>{
 unlockAudio();
 start();
};

function start(list){
 q=list||Array.from({length:30},()=> {
  let a=1+Math.floor(Math.random()*9);
  let b=1+Math.floor(Math.random()*9);
  return {a,b};
 });
 idx=0;correct=0;wrong=0;
 wrongDetail=[];correctTimes=[];
 document.getElementById("startCard").style.display="none";
 document.getElementById("quizCard").style.display="block";
 next();
}

function next(){
 if(idx>=q.length){finish();return;}
 ans="";
 document.getElementById("answerBox").innerText="";
 let {a,b}=q[idx];
 document.getElementById("question").innerText=`${a} Ã— ${b} = ?`;
 document.getElementById("progress").innerText=`ç¬¬ ${idx+1} / ${q.length} é¡Œ`;
 sec=8;
 document.getElementById("timer").innerText=`â± ${sec}`;
 clearInterval(timer);
 timer=setInterval(()=>{
  sec--;
  tick.currentTime=0;tick.play();
  document.getElementById("timer").innerText=`â± ${sec}`;
  if(sec<=0){clearInterval(timer);mark(false);}
 },1000);
}

function press(n){
 if(ans.length>=3)return;
 ans+=n;
 document.getElementById("answerBox").innerText=ans;
}

function del(){
 ans=ans.slice(0,-1);
 document.getElementById("answerBox").innerText=ans;
}

function submit(){
 if(ans==="")return;
 let {a,b}=q[idx];
 mark(Number(ans)===a*b);
}

function mark(ok){
 clearInterval(timer);
 let {a,b}=q[idx];
 if(ok){
  correct++;
  correctTimes.push(8-sec);
  audioOK.currentTime=0;audioOK.play();
 }else{
  wrong++;
  wrongDetail.push(`${a}Ã—${b}=${a*b}`);
  audioWrong.currentTime=0;audioWrong.play();
 }
 idx++;
 setTimeout(next,800);
}

function finish(){
 audioEnd.play();
 let avg=correctTimes.length?
 (correctTimes.reduce((a,b)=>a+b)/correctTimes.length).toFixed(1):0;
 document.getElementById("quizCard").style.display="none";
 document.getElementById("resultOverlay").style.display="flex";
 document.getElementById("resultCard").innerHTML=`
  <div class="resultHeader">ğŸ“˜ æˆç¸¾å–®</div>
  <div class="scoreRow"><span>âœ” ç­”å°</span><span>${correct}</span></div>
  <div class="scoreRow"><span>âœ– ç­”éŒ¯</span><span>${wrong}</span></div>
  <div class="scoreRow"><span>â± å¹³å‡æ™‚é–“</span><span>${avg} ç§’</span></div>

  <button class="resultBtn retry" onclick="start(q.filter((_,i)=>wrongDetail.includes(q[i].a+'Ã—'+q[i].b+'='+(q[i].a*q[i].b))))">ğŸ” éŒ¯é¡Œé‡ç·´</button>
  <button class="resultBtn restart" onclick="location.reload()">ğŸ“ é‡æ–°æ¸¬é©—</button>

  <div class="wrongList">
   ${wrongDetail.map(w=>`<div class="wrongItem">âŒ ${w}</div>`).join("")||"ğŸ‰ å…¨å°ï¼"}
  </div>
 `;
}
</script>

</body>
</html>
