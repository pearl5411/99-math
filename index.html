<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>99ä¹˜æ³•è€ƒè©¦ï¼ˆåš´æ ¼ç‰ˆï¼‰</title>

<style>
html,body{
 margin:0;padding:0;
 font-family:"Arial Rounded MT Bold","Arial",sans-serif;
 background:linear-gradient(#fdecea,#ffffff);
 touch-action:manipulation;
 user-select:none;
}
.container{
 max-width:420px;
 margin:auto;
 padding:20px;
 text-align:center;
}
h1{color:#d32f2f;}
#status{font-size:18px;color:#555;}
#timer{font-size:22px;color:#d32f2f;font-weight:bold;}
#question{
 font-size:34px;
 background:#fff3e0;
 padding:15px;
 border-radius:20px;
 margin:15px 0;
}
#answerReveal{
 display:none;
 font-size:32px;
 color:#d32f2f;
 font-weight:bold;
 margin:10px 0;
}
#input{
 width:100%;
 height:55px;
 font-size:30px;
 text-align:center;
 border-radius:15px;
 border:3px solid #ef9a9a;
 background:#ffebee;
}
.keypad{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:12px;
 margin-top:15px;
}
.keypad button{
 font-size:26px;
 padding:20px;
 border-radius:20px;
 border:none;
 background:#ef5350;
 color:white;
}
button.control{
 margin-top:18px;
 padding:12px 30px;
 font-size:20px;
 border-radius:20px;
 border:none;
 background:#c62828;
 color:white;
}
</style>
</head>

<body>
<div class="container">
<h1>99ä¹˜æ³•è€ƒè©¦ï¼ˆåš´æ ¼ç‰ˆï¼‰</h1>

<div id="status">å°šæœªé–‹å§‹</div>
<div id="timer">æ™‚é–“ï¼š8</div>
<div id="question">è«‹æŒ‰é–‹å§‹</div>
<div id="answerReveal"></div>
<input id="input" readonly>

<div class="keypad">
<button>1</button><button>2</button><button>3</button>
<button>4</button><button>5</button><button>6</button>
<button>7</button><button>8</button><button>9</button>
<button>0</button><button>æ¸…é™¤</button>
</div>

<button class="control" id="startBtn">é–‹å§‹æ¸¬é©—</button>
</div>

<script>
/* ===== èªéŸ³ ===== */
function speak(t){
 speechSynthesis.cancel();
 const u=new SpeechSynthesisUtterance(t);
 u.lang="zh-TW";
 u.rate=0.9;
 speechSynthesis.speak(u);
}

/* ===== éŸ³æ•ˆ ===== */
let audioCtx;
function unlockAudio(){
 if(!audioCtx){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
 }
 if(audioCtx.state==="suspended") audioCtx.resume();
}

/* ===== éŠæˆ²è³‡æ–™ ===== */
const TOTAL=30, LIMIT=8;
let q=0,a=0,b=0,ans=0,time=0,timer;
let playing=false;
let correct=0;
let wrongCount={};
let questionStartTime=0;
let correctTimes=[];

const startBtn=document.getElementById("startBtn");
const reveal=document.getElementById("answerReveal");

/* é–‹å§‹ / é‡æ–°æ¸¬é©— */
startBtn.onclick=()=>{
 if(playing) return;
 unlockAudio();
 start();
};

function start(){
 q=0; correct=0; wrongCount={}; correctTimes=[];
 reveal.style.display="none";
 playing=true;
 startBtn.textContent="æ¸¬é©—ä¸­";
 startBtn.disabled=true;
 next();
}

function next(){
 clearInterval(timer);
 reveal.style.display="none";

 if(q>=TOTAL){
  end();
  return;
 }

 q++;
 time=LIMIT;
 document.getElementById("status").textContent=`ç¬¬ ${q} / ${TOTAL} é¡Œ`;
 document.getElementById("timer").textContent=`æ™‚é–“ï¼š${time}`;
 document.getElementById("input").value="";

 a=Math.floor(Math.random()*9)+1;
 b=Math.floor(Math.random()*9)+1;
 ans=a*b;
 document.getElementById("question").textContent=`${a} Ã— ${b} = ?`;

 questionStartTime=Date.now();

 timer=setInterval(()=>{
  time--;
  document.getElementById("timer").textContent=`æ™‚é–“ï¼š${time}`;
  if(time<=0){
   recordWrong();
  }
 },1000);
}

/* éµç›¤ */
document.querySelectorAll(".keypad button").forEach(btn=>{
 btn.onclick=()=>{
  if(!playing) return;
  unlockAudio();
  if(btn.textContent==="æ¸…é™¤"){
   document.getElementById("input").value="";
   return;
  }
  press(btn.textContent);
 };
});

function press(n){
 const input=document.getElementById("input");
 input.value+=n;

 if(+input.value===ans){
  correct++;
  const spend=(Date.now()-questionStartTime)/1000;
  correctTimes.push(spend);
  next();
 }else if(input.value.length>=ans.toString().length){
  recordWrong();
 }
}

function recordWrong(){
 clearInterval(timer);
 speak("ç­”éŒ¯äº†");

 const key=`${a}Ã—${b}`;
 wrongCount[key]=(wrongCount[key]||0)+1;

 reveal.textContent=`æ­£ç¢ºç­”æ¡ˆï¼š${a} Ã— ${b} = ${ans}`;
 reveal.style.display="block";

 setTimeout(next,1200);
}

function end(){
 playing=false;
 startBtn.disabled=false;
 startBtn.textContent="é‡æ–°æ¸¬é©—";
 speak("æ­å–œä½ å®Œæˆæ¸¬é©—");

 let worst="ç„¡",max=0;
 for(let k in wrongCount){
  if(wrongCount[k]>max){max=wrongCount[k];worst=k;}
 }

 const avg = correctTimes.length
  ? (correctTimes.reduce((a,b)=>a+b,0)/correctTimes.length).toFixed(1)
  : 0;

 alert(
  `ğŸ“Š æˆç¸¾ç¸½çµ\n\n`+
  `âœ” ç­”å°ï¼š${correct} / ${TOTAL}\n`+
  `â± å¹³å‡ç­”å°æ™‚é–“ï¼š${avg} ç§’\n`+
  `âŒ éŒ¯æœ€å¤šçš„ä¹˜æ³•ï¼š${worst}`
 );
}
</script>
</body>
</html>
